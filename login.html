<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Display QR Code</title>
</head>
<style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }

</style>

<body class="w-[100vw] h-[100vh] flex justify-center items-center">
<div class="flex flex-col w-3/4 md:w-auto bg-white shadow-xl rounded-[10px] overflow-hidden">
    <ul class="steps p-[10px]">
        <li id="step1" class="step step-primary">Log In</li>
        <li id="step2" class="step">Confirm with your authenticator</li>
    </ul>
    <div id="login-step" class="flex w-full md:w-auto flex-col gap-y-6 bg-white p-6">
        <h1 class="text-2xl text-center">Login</h1>
        <input type="text" id="username" placeholder="Username" class="input input-primary">
        <input type="password" id="password" placeholder="Password" class="input">
        <button onclick="logIn()" class="btn btn-primary">Go to next step</button>
        <a href="register.html">Go to register page</a>
    </div>
    <div id="authenticator-step" class="hidden flex w-full md:w-auto flex-col gap-y-6 bg-white p-6">
        <h1 class="text-2xl text-center">Confirm with your authenticator</h1>
        <input id="code" type="number" class="input" placeholder="Enter you code" maxlength="6"/>
        <button onclick="verify()" class="btn btn-primary">Go to next step</button>
        <a href="register.html">Go to register page</a>
    </div>
</div>
</body>

<script>
    async function logIn() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('http://localhost/totp-api/src/index.php/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            });
            console.log(response);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            } else {
                document.getElementById('login-step').classList.add('hidden');
                document.getElementById('authenticator-step').classList.remove('hidden');
                document.getElementById('step2').classList.add('step-primary');
            }
        } catch (error) {
            console.error('Error:', error);
            // Handle error
        }
    }

    async function verify() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const code = document.getElementById('code').value;

        try {
            const response = await fetch('http://localhost/totp-api/src/index.php/verify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    password: password,
                    totp_code: code,
                })
            });
            console.log(response);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            } else {
                // Assuming the next step or success message is shown here
                alert("Verification successful!");
            }
        } catch (error) {
            console.error('Error:', error);
            // Handle error
        }
    }
</script>

</html>
